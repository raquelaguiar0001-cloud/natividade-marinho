<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bio-Lab Master v12.2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Orbitron:wght@600;900&display=swap');
        :root { --rainbow: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff); --neon-blue: #00d2ff; --neon-pink: #ff00e0; }
        body { margin: 0; padding: 0; height: 100vh; overflow: hidden; font-family: 'Fredoka', sans-serif; background: #050a18; color: white; }
        
        /* FUNDO DINÃ‚MICO */
        .stars-bg { position: fixed; width: 100%; height: 100%; background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); z-index: -1; }
        
        /* TELA DE APRESENTAÃ‡ÃƒO */
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 10, 24, 0.98); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .splash-card { padding: 40px; border-radius: 30px; border: 3px solid var(--neon-blue); text-align: center; background: #050a18; box-shadow: 0 0 30px var(--neon-blue); width: 90%; max-width: 400px; }
        
        /* APP PRINCIPAL */
        #main-app { display: none; flex-direction: column; height: 100vh; }
        header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--neon-blue); background: rgba(0,0,0,0.5); }
        .wrapper { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .sidebar { width: 320px; overflow-y: auto; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; }
        
        /* PISTA DE CORRIDA */
        .track-container { flex: 1; position: relative; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 20px; overflow-y: auto; }
        .rainbow-bridge { position: absolute; right: 60px; top: 0; bottom: 0; width: 40px; background: var(--rainbow); opacity: 0.3; border-radius: 20px; }
        .lane { height: 70px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; display: flex; align-items: center; }
        .runner { position: absolute; transition: 1s ease-in-out; display: flex; flex-direction: column; align-items: center; }
        .runner-tag { background: white; color: black; font-size: 10px; padding: 2px 6px; border-radius: 5px; font-weight: bold; margin-bottom: 2px; white-space: nowrap; }
        
        /* COMPONENTES */
        .panel { background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px; padding: 10px; }
        .btn-cosmic { background: var(--rainbow); border: none; color: white; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; }
        .student-card { background: rgba(0,0,0,0.3); border: 1px solid var(--neon-pink); padding: 8px; border-radius: 10px; margin-bottom: 8px; }
        .editable { cursor: pointer; border-bottom: 1px dashed var(--neon-blue); }
        input, textarea { background: #000; color: #fff; border: 1px solid var(--neon-blue); padding: 5px; border-radius: 5px; width: 100%; box-sizing: border-box; }
        .check-grid { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="stars-bg"></div>

    <div id="splash-screen">
        <div class="splash-card">
            <h1 style="font-family:'Orbitron'; color:var(--neon-blue); margin:0;">BIO-LAB</h1>
            <p>COSMIC CAMPUS v12.2</p>
            <input type="text" id="sch-in" placeholder="NOME DA ESCOLA" style="margin-bottom:10px;">
            <input type="text" id="tea-in" placeholder="PROFESSOR(A)">
            <button class="btn-cosmic" onclick="enterApp()">ENTRAR ðŸš€</button>
        </div>
    </div>

    <div id="main-app">
        <header>
            <div>
                <span class="editable" id="h-sch" onclick="editAny('Escola', 'h-sch', 'sch')">Escola</span> | 
                <span class="editable" id="h-tea" onclick="editAny('Professor', 'h-tea', 'tea')">ProfÂª</span>
            </div>
            <div style="display:flex; gap:10px;">
                <button onclick="showSplash()" style="font-size:10px; cursor:pointer;">MODO APRESENTAÃ‡ÃƒO</button>
                <button onclick="exportExcel()" style="background:green; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">Excel</button>
            </div>
        </header>

        <div class="wrapper">
            <aside class="sidebar">
                <div class="panel">
                    <b>TURMAS</b>
                    <div id="class-tabs"></div>
                    <input type="text" id="new-cl" placeholder="+ Turma" onkeypress="if(event.key==='Enter') addClass()">
                </div>
                
                <div id="student-zone" style="display:none;">
                    <div class="panel">
                        <b>MATÃ‰RIAS/ALUNOS</b>
                        <div id="subj-tabs" style="margin:5px 0;"></div>
                        <textarea id="names-in" placeholder="Cole nomes e clique importar" style="height:50px;"></textarea>
                        <button class="btn-cosmic" onclick="importStudents()">IMPORTAR</button>
                    </div>
                    <div id="stu-list"></div>
                </div>
            </aside>

            <main class="track-container">
                <div id="bim-nav" style="margin-bottom:10px; display:flex; gap:5px;"></div>
                <div class="track" id="track">
                    <div class="rainbow-bridge"></div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let state = JSON.parse(localStorage.getItem('biolab_v12.2')) || { classes: [], activeClassIdx: -1, activeBim: 1 };
        const emojis = ['ðŸš€','ðŸ§¬','ðŸ§ª','ðŸŒŸ','ðŸ›¸','ðŸ‘¾'];

        function save() { localStorage.setItem('biolab_v12.2', JSON.stringify(state)); }

        function showSplash() { document.getElementById('splash-screen').style.display='flex'; }

        function enterApp() {
            const s = document.getElementById('sch-in').value || localStorage.getItem('sch') || 'Escola';
            const t = document.getElementById('tea-in').value || localStorage.getItem('tea') || 'Professora';
            localStorage.setItem('sch', s); localStorage.setItem('tea', t);
            document.getElementById('h-sch').innerText = s;
            document.getElementById('h-tea').innerText = t;
            document.getElementById('splash-screen').style.display='none';
            document.getElementById('main-app').style.display='flex';
            render();
        }

        function editAny(label, elementId, storageKey) {
            let val = prompt("Editar " + label, document.getElementById(elementId).innerText);
            if(val) { 
                document.getElementById(elementId).innerText = val;
                if(storageKey) localStorage.setItem(storageKey, val);
            }
        }

        function editStudent(idx) {
            let n = prompt("Nome do aluno:", state.classes[state.activeClassIdx].students[idx].name);
            if(n) { state.classes[state.activeClassIdx].students[idx].name = n; save(); render(); }
        }

        function addClass() {
            let n = document.getElementById('new-cl').value;
            if(n) { state.classes.push({name:n, subjects:['CiÃªncias'], activeSubjIdx:0, students:[]}); state.activeClassIdx = state.classes.length-1; document.getElementById('new-cl').value=''; save(); render(); }
        }

        function importStudents() {
            let raw = document.getElementById('names-in').value.split('\n').filter(x=>x.trim());
            raw.forEach(n => state.classes[state.activeClassIdx].students.push({name:n.trim(), emoji:emojis[Math.floor(Math.random()*emojis.length)], scores:{}}));
            state.classes[state.activeClassIdx].students.sort((a,b)=>a.name.localeCompare(b.name));
            document.getElementById('names-in').value=''; save(); render();
        }

        function getScore(stu) {
            let cls = state.classes[state.activeClassIdx];
            let key = `${cls.activeSubjIdx}_${state.activeBim}`;
            return (stu.scores[key] || []).length;
        }

        function render() {
            const cls = state.classes[state.activeClassIdx];
            document.getElementById('class-tabs').innerHTML = state.classes.map((c,i)=>`<button onclick="state.activeClassIdx=${i};render()" style="${i===state.activeClassIdx?'border:2px solid gold':''}">${c.name}</button>`).join(' ');
            
            if(cls) {
                document.getElementById('student-zone').style.display='block';
                document.getElementById('subj-tabs').innerHTML = cls.subjects.map((s,i)=>`<span class="editable" onclick="state.classes[state.activeClassIdx].activeSubjIdx=${i};render()" style="margin-right:10px;${i===cls.activeSubjIdx?'color:cyan;font-weight:bold':''}">${s}</span>`).join('');
                document.getElementById('bim-nav').innerHTML = [1,2,3,4].map(b => `<button onclick="state.activeBim=${b};render()" style="${b===state.activeBim?'background:cyan;color:black':''}">${b}Âº BIM</button>`).join(' ');
                
                // Lista lateral
                document.getElementById('stu-list').innerHTML = cls.students.map((s,i) => {
                    let key = `${cls.activeSubjIdx}_${state.activeBim}`;
                    let checks = '';
                    for(let j=0; j<10; j++) {
                        let chk = (s.scores[key] && s.scores[key].includes(j)) ? 'checked' : '';
                        checks += `<input type="checkbox" ${chk} onclick="toggleCheck(${i}, '${key}', ${j})">`;
                    }
                    return `<div class="student-card"><span class="editable" onclick="editStudent(${i})">${s.name}</span><div class="check-grid">${checks}</div></div>`;
                }).join('');

                // Track
                let t = document.getElementById('track');
                t.querySelectorAll('.lane').forEach(l=>l.remove());
                cls.students.forEach(s => {
                    let sc = getScore(s);
                    let lane = document.createElement('div'); lane.className='lane';
                    lane.innerHTML = `<div class="runner" style="left:${sc*9}%"><div class="runner-tag">${s.name}</div><div style="font-size:30px">${s.emoji}</div></div>`;
                    t.appendChild(lane);
                });
            }
        }

        function toggleCheck(si, key, val) {
            let s = state.classes[state.activeClassIdx].students[si];
            if(!s.scores[key]) s.scores[key] = [];
            let i = s.scores[key].indexOf(val);
            if(i > -1) s.scores[key].splice(i,1); else s.scores[key].push(val);
            save(); render();
        }

        function exportExcel() {
            let cls = state.classes[state.activeClassIdx];
            let csv = `Relatorio;${cls.name}\nAluno;Nota\n`;
            cls.students.forEach(s => csv += `${s.name};${getScore(s)}\n`);
            let blob = new Blob(["\ufeff"+csv], {type:'text/csv'});
            let a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${cls.name}.csv`; a.click();
        }

        window.onload = () => { if(localStorage.getItem('sch')) enterApp(); };
    </script>
</body>
</html>
